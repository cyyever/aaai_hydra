<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>HYDRA demo</title>
    <link
      rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css"
    />

    <!-- Import PhotoSwipe Styles -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.0/photoswipe.css"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.0/default-skin/default-skin.css"
    />

    <!-- A touch of fanciness ðŸ’„ -->
    <link
      href="https://fonts.googleapis.com/css?family=Bitter:400,700,400italic"
      rel="stylesheet"
      type="text/css"
    />
    <style>
      body {
        font-family: "Bitter", Georgia, Times, sans-serif;
      }
      h1 {
        margin: 2em;
      }
      .pswp__caption__center {
        text-align: center;
      }
      figure {
        display: inline-block;
        width: 33.333%;
      }
      img {
        width: 100%;
      }
      .spacer {
        height: 5em;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="row">
        <div class="col-sm-8 col-sm-offset-2">
          <h1 class="text-center">
            <em
              >Demo for
              <a
                id="hydra_url"
                target="_blank"
                href="https://arxiv.org/abs/2102.02515"
                >HYDRA</a
              ></em
            >
          </h1>

          <div class="text-center">
            <h2>Choose a dataset and click the image to slide through</h3>
            <div class="radio-inline">
              <input type="radio" name="dataset" value="MNIST" checked />
              <label>MNIST</label>
            </div>
            <div class="radio-inline">
              <input type="radio" name="dataset" value="CIFAR10" />
              <label>CIFAR10</label>
            </div>
          </div>
          <!-- Galley wrapper that contains all items -->
          <div
            id="gallery"
            class="gallery"
            itemscope
            itemtype="http://schema.org/ImageGallery"
          ></div>
        </div>
      </div>
    </div>

    <!-- Some spacing ðŸ˜‰ -->
    <div class="spacer"></div>

    <!-- Root element of PhotoSwipe. Must have class pswp. -->
    <div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">
      <!-- Background of PhotoSwipe.
           It's a separate element as animating opacity is faster than rgba(). -->
      <div class="pswp__bg"></div>
      <!-- Slides wrapper with overflow:hidden. -->
      <div class="pswp__scroll-wrap">
        <!-- Container that holds slides.
              PhotoSwipe keeps only 3 of them in the DOM to save memory.
              Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
          <div class="pswp__item"></div>
          <div class="pswp__item"></div>
          <div class="pswp__item"></div>
        </div>
        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">
          <div class="pswp__top-bar">
            <!--  Controls are self-explanatory. Order can be changed. -->
            <div class="pswp__counter"></div>
            <button
              class="pswp__button pswp__button--close"
              title="Close (Esc)"
            ></button>
            <button
              class="pswp__button pswp__button--share"
              title="Share"
            ></button>
            <button
              class="pswp__button pswp__button--fs"
              title="Toggle fullscreen"
            ></button>
            <button
              class="pswp__button pswp__button--zoom"
              title="Zoom in/out"
            ></button>
            <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
            <!-- element will get class pswp__preloader--active when preloader is running -->
            <div class="pswp__preloader">
              <div class="pswp__preloader__icn">
                <div class="pswp__preloader__cut">
                  <div class="pswp__preloader__donut"></div>
                </div>
              </div>
            </div>
          </div>
          <div
            class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"
          >
            <div class="pswp__share-tooltip"></div>
          </div>
          <button
            class="pswp__button pswp__button--arrow--left"
            title="Previous (arrow left)"
          ></button>
          <button
            class="pswp__button pswp__button--arrow--right"
            title="Next (arrow right)"
          ></button>
          <div class="pswp__caption">
            <div class="pswp__caption__center"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- Import jQuery and PhotoSwipe Scripts -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.0/photoswipe.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.0/photoswipe-ui-default.min.js"></script>

    <script>
      "use strict";

      /* global jQuery, PhotoSwipe, PhotoSwipeUI_Default, console */

      (function ($) {
        // Init empty gallery array
        var container = [];

        var $radios = $("input:radio[name=dataset]");
        $radios.click(function (event) {
          var dataset_name = $radios.filter(":checked").prop("value");
          $.getJSON(dataset_name + ".result.json", function (data) {
            container = [];
            var items = [];
            $.each(data, function (index, info_list) {
              var image_path = info_list[0];
              var label = info_list[1];
              var contribution = info_list[2];
              var caption =
                "The " +
                index +
                "th image of " +
                dataset_name +
                " with label '" +
                label +
                "',<br> and "+(contribution<0?"negative":"positive")+" contribution " +
                contribution;
              container.push({
                src: image_path,
                w:0,
                h:0,
                title: caption,
              });
              if (items.length == 0) {
                items.push(`
            <figure
                  class='center-block'
              itemprop='associatedMedia'
              itemscope
              itemtype='http://schema.org/ImageObject'
            >
              <a
                href='${image_path}'
                itemprop='contentUrl'
              >
                <img
                  src='${image_path}'
                  itemprop='thumbnail'
                />
              </a>
            </figure>
                  `);
              }
            });

            $("#gallery").html(items.join(""));

            // Define click event on gallery item
            $("#gallery a")
              .off("click")
              .click(function (event) {
                // Prevent location change
                event.preventDefault();

                // Define object and gallery options
                var $pswp = $(".pswp")[0],
                  options = {
                    index: $(this).parent("figure").index(),
                    bgOpacity: 0.85,
                    showHideOpacity: true,
                  };

                // Initialize PhotoSwipe
                var gallery = new PhotoSwipe(
                  $pswp,
                  PhotoSwipeUI_Default,
                  container,
                  options
                );

                gallery.listen('gettingData', function(index, item) {
                  if (item.w < 1 || item.h < 1) { // unknown size
                    var img = new Image();
                    img.onload = function() { // will get size after load
                    var  max_edge=Math.max(this.width,this.height)
                    item.w = Math.floor(400/max_edge*this.width);
                    item.h = Math.floor(400/max_edge*this.height);
                    gallery.invalidateCurrItems(); // reinit Items
                    gallery.updateSize(true); // reinit Items
                    }
                    img.src = item.src; // let's download image
                  }
                  });
                gallery.init();
              });
          });
        });
        $radios.filter("[value=MNIST]").click();
      })(jQuery);
    </script>
  </body>
</html>
